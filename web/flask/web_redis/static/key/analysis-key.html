<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>分析按键</title>

    <script src="/static/js/js_lib/jquery.v3.3.1.min.js"></script>
    <script src="/static/js/config.js"></script>
    <script src="/static/js/js_lib/echart.v4.0.4.min.js"></script>

    <style>
    .line-chart{
        width: 100%;
        height:400px;
        top: 50px;
    }
    </style>
</head>

<body>
    周期<input id="period" value="5" type="number"/>
    偏移<input id="offset" value="0" type="number"/>
    top<input id="top" value="5" type="number"/>
    <button onclick="add()">生成图表</button>
    <div id="main" class="line-chart"></div>
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        const chart = echarts.init(document.getElementById('main'));
        option = {
            title: {
                text: '按键分析-折线图堆叠'
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['1']
            },
            grid: {
                left: '2%',
                right: '5%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: {
                feature: {
                    saveAsImage: {}
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: []
            },
            yAxis: {
                type: 'value'
            },
            series: []
        };
        // 使用刚指定的配置项和数据显示图表。
        chart.setOption(option);

        function add() {
            titleList = []
            var period = $("#period").val();
            var offset = $("#offset").val();
            var top = $("#top").val();
            handleGet('/recent_day/'+period+'/'+offset, function(data1){
                handleGet('/most_key/'+period+'/'+offset+'/'+top, function(data2){
                    handleGet('/most_key_with_num/'+period+'/'+offset+'/'+top, function(data3){
                        chart.setOption({
                            xAxis: {
                                type: 'category',
                                boundaryGap: false,
                                data: data1.data
                            },
                            legend: {
                                data: data2.data
                            },
                            series: data3.data
                        });
                    }, null)
                }, null)

            }, function(data){
                alert('连接失败' + data.responseText)
            });
        }
    </script>
</body>

</html>