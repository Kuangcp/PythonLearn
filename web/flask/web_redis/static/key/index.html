<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Web-Redis</title>
    <script src="/static/js/js_lib/jquery.v3.3.1.min.js"></script>
    <script src="/static/js/layer/layer.js"></script>
    <script src="/static/js/config.js"></script>

    <style>
        li{
            list-style:none; 
        }
        .init_form input {
            width: 120px;
            margin-top: 5px;
        }

        .init_form {
            text-align: center;
        }

        .init_form button {
            margin-top: 10px;
        }
        .set-form input{
            width: 160px;
        }
        .get-form input{
            width:120px;
        }
    </style>
</head>

<body>
    <a href="analysis-key.html">
        <button>统计图</button>
    </a>
    <a href="string.html">
        <button>String</button>
    </a>
    <button onclick="init()">初始化连接</button>
    <button onclick="string()">String - tip</button>

    <script type="text/html" id="init_redis">
        <div class="init_form">
            主机&nbsp;:&nbsp;
            <input type="text" id="host" value="127.0.0.1" />
            <br> 端口&nbsp;:&nbsp;
            <input type="number" id="port" value="6666" />
            <br> 密码&nbsp;:&nbsp;
            <input type="text" id="pass" value="" />
            <br> D&nbsp;B&nbsp;&nbsp;:&nbsp;
            <input type="number" id="db" value="2" />
            <br>
            <button onclick="initRedis()">初始化连接</button>
        </div>
    </script>
    <script type="text/html" id="set_key">
        <form id="set-form" class="set-form">
            <input type="text" id="key" required/> <->
            <input type="text" id="value" required/><br><br>
            <button>新增 string</button>
        </form>
    </script>
    <script type="text/html" id="get_key">
        <form id="get-form" class="get-form">
            <input type="text" id="get-key" required/>
            <button>获取 string</button> --> 
            <span id="get-result" style="color:red;"></span>
        </form>
    </script>
    <script type="text/html" id="list_key">
        <form id="list-form" class="list-form">
            <input type="text" id="list-key" required/>
            <button>获取列表</button> 
        </form>
    </script>

    <script>
        function initRedis() {
            const data = {
                host: $("#host").val(),
                port: $("#port").val(),
                password: $("#pass").val(),
                db: $("#db").val()
            };
            handlePost('/init_redis', data, function (data) {
                if (data.code == '0') {
                    layer.closeAll()
                    layer.msg('连接成功')
                } else {
                    layer.msg('连接失败')
                }
            }, function (data) {
                layer.msg('连接失败', JSON.stringify(data.reponseText))
            })
        }

        function init() {
            tip(['200px', '230px'], '初始化连接', $("#init_redis").html());
        }
        function string(){
            var set_content = $("#set_key").html()
            var get_content = $("#get_key").html()
            var list_content = $("#list_key").html()
            layer.tab({
                area: ['500px', '520px'],
                tab: [{
                    title: 'set', 
                    content: set_content
                }, {
                    title: 'get', 
                    content: get_content
                }, {
                    title: 'all-keys', 
                    content: list_content
                }]
            });        
            $("#set-form").submit(function(e){
                e.preventDefault();
                set();
            });
            $("#get-form").submit(function(e){
                e.preventDefault();
                get();
            });
        }
        
        function set(){
            var key = $("#key").val()
            var value = $("#value").val()
            handlePost('/key',  {
                key: key, 
                value: value
            }, function(data){
                console.log(data)
            }, function(data){
                console.log(data)
            })
        }
        function get(){
            var key = $("#get-key").val();
            handleGet('/key/'+key, function(data){
                if(data.code == '404'){
                    $("#get-result").text('没有该键')
                }else if(data.code == '405'){
                    $("#get-result").text("该键不是String类型")
                }else{
                    $("#get-result").text(data.data)
                }
            }, function(data){})
        }
    </script>
    <br>

</body>

</html>